var y=Object.defineProperty;var S=(e,t,o)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var h=(e,t,o)=>(S(e,typeof t!="symbol"?t+"":t,o),o);import{o as l,p as d,d as p,S as w,C as g,g as f,q as O,r as E,a as b,w as R,t as M,u as m}from"./index-iGRhHhaY.js";import{H as A}from"./harvest-scheduler-2-eCNpfP.js";import{A as T,i as P,g as j,v as C}from"./aggregate-base-rpFAq55Q.js";import"./session-entity-L9wlHB7X.js";import"./invoke-yZTpZaXg.js";const r={REACT:"React",NEXTJS:"NextJS",VUE:"Vue",NUXTJS:"NuxtJS",ANGULAR:"Angular",ANGULARUNIVERSAL:"AngularUniversal",SVELTE:"Svelte",SVELTEKIT:"SvelteKit",PREACT:"Preact",PREACTSSR:"PreactSSR",ANGULARJS:"AngularJS",BACKBONE:"Backbone",EMBER:"Ember",METEOR:"Meteor",ZEPTO:"Zepto",JQUERY:"Jquery",MOOTOOLS:"MooTools",QWIK:"Qwik",ELECTRON:"Electron"};function N(){if(!l)return[];const e=[];try{U()&&(e.push(r.REACT),v()&&e.push(r.NEXTJS)),x()&&(e.push(r.VUE),k()&&e.push(r.NUXTJS)),L()&&(e.push(r.ANGULAR),I()&&e.push(r.ANGULARUNIVERSAL)),G()&&(e.push(r.SVELTE),B()&&e.push(r.SVELTEKIT)),_()&&(e.push(r.PREACT),J()&&e.push(r.PREACTSSR)),D()&&e.push(r.ANGULARJS),Object.prototype.hasOwnProperty.call(window,"Backbone")&&e.push(r.BACKBONE),Object.prototype.hasOwnProperty.call(window,"Ember")&&e.push(r.EMBER),Object.prototype.hasOwnProperty.call(window,"Meteor")&&e.push(r.METEOR),Object.prototype.hasOwnProperty.call(window,"Zepto")&&e.push(r.ZEPTO),Object.prototype.hasOwnProperty.call(window,"jQuery")&&e.push(r.JQUERY),Object.prototype.hasOwnProperty.call(window,"MooTools")&&e.push(r.MOOTOOLS),Object.prototype.hasOwnProperty.call(window,"qwikevents")&&e.push(r.QWIK),q()&&e.push(r.ELECTRON)}catch{}return e}function U(){try{return Object.prototype.hasOwnProperty.call(window,"React")||Object.prototype.hasOwnProperty.call(window,"ReactDOM")||Object.prototype.hasOwnProperty.call(window,"ReactRedux")||document.querySelector("[data-reactroot], [data-reactid]")||(()=>{const e=document.querySelectorAll("body > div");for(let t=0;t<e.length;t++)if(Object.prototype.hasOwnProperty.call(e[t],"_reactRootContainer"))return!0})()}catch{return!1}}function v(){try{return Object.prototype.hasOwnProperty.call(window,"next")&&Object.prototype.hasOwnProperty.call(window.next,"version")}catch{return!1}}function x(){try{return Object.prototype.hasOwnProperty.call(window,"Vue")}catch{return!1}}function k(){try{return Object.prototype.hasOwnProperty.call(window,"$nuxt")&&Object.prototype.hasOwnProperty.call(window.$nuxt,"nuxt")}catch{return!1}}function L(){try{return Object.prototype.hasOwnProperty.call(window,"ng")||document.querySelector("[ng-version]")}catch{return!1}}function I(){try{return document.querySelector("[ng-server-context]")}catch{return!1}}function G(){try{return Object.prototype.hasOwnProperty.call(window,"__svelte")}catch{return!1}}function B(){try{return!!Object.keys(window).find(e=>e.startsWith("__sveltekit"))}catch{return!1}}function _(){try{return Object.prototype.hasOwnProperty.call(window,"preact")}catch{return!1}}function J(){try{return document.querySelector('script[type="__PREACT_CLI_DATA__"]')}catch{return!1}}function D(){try{return Object.prototype.hasOwnProperty.call(window,"angular")||document.querySelector(".ng-binding, [ng-app], [data-ng-app], [ng-controller], [data-ng-controller], [ng-repeat], [data-ng-repeat]")||document.querySelector('script[src*="angular.js"], script[src*="angular.min.js"]')}catch{return!1}}function q(){try{return typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0}catch{return!1}}class V extends T{constructor(t,o){super(t,o,d);let s;p("block-err",()=>{this.blocked=!0,s&&(s.aborted=!0)},this.featureName,this.ee),p(w,this.storeSupportabilityMetrics.bind(this),this.featureName,this.ee),p(g,this.storeEventMetrics.bind(this),this.featureName,this.ee),this.singleChecks(),this.eachSessionChecks(),this.ee.on("drain-".concat(this.featureName),()=>{s=new A("jserrors",{onUnload:()=>this.unload()},this),s.harvest.on("jserrors",()=>({body:this.aggregator.take(["cm","sm"])}))}),this.drain()}storeSupportabilityMetrics(t,o){if(this.blocked)return;const s=M,n={name:t};this.aggregator.storeMetric(s,t,n,o)}storeEventMetrics(t,o){if(this.blocked)return;const s=m,n={name:t};this.aggregator.store(s,t,n,o)}singleChecks(){var c;const{distMethod:t,loaderType:o}=f(this.agentIdentifier);if(o&&this.storeSupportabilityMetrics("Generic/LoaderType/".concat(o,"/Detected")),t&&this.storeSupportabilityMetrics("Generic/DistMethod/".concat(t,"/Detected")),l){this.storeSupportabilityMetrics("Generic/Runtime/Browser/Detected");const a=(c=document==null?void 0:document.currentScript)==null?void 0:c.nonce;a&&a!==""&&this.storeSupportabilityMetrics("Generic/Runtime/Nonce/Detected"),O(()=>{N().forEach(i=>{this.storeSupportabilityMetrics("Framework/"+i+"/Detected")})})}else E?this.storeSupportabilityMetrics("Generic/Runtime/Worker/Detected"):this.storeSupportabilityMetrics("Generic/Runtime/Unknown/Detected");P()&&this.storeSupportabilityMetrics("Generic/FileProtocol/Detected");const s=j(this.agentIdentifier);s.length>0&&this.storeSupportabilityMetrics("Generic/Obfuscate/Detected"),s.length>0&&!C(s)&&this.storeSupportabilityMetrics("Generic/Obfuscate/Invalid");const{proxy:n}=b(this.agentIdentifier);n.assets&&this.storeSupportabilityMetrics("Config/AssetsUrl/Changed"),n.beacon&&this.storeSupportabilityMetrics("Config/BeaconUrl/Changed")}eachSessionChecks(){l&&R("pageshow",t=>{t.persisted&&this.storeSupportabilityMetrics("Generic/BFCache/PageRestored")})}unload(){try{let n=function(i){return s.some(u=>i.name.indexOf(u)>=0)},c=function(i){return o.includes(i.initiatorType)};if(this.resourcesSent)return;this.resourcesSent=!0;const t=f(this.agentIdentifier),o=["beacon","fetch","xmlhttprequest"],s=["nr-data.net","newrelic.com","nr-local.net","localhost"];if(((performance==null?void 0:performance.getEntriesByType("resource"))||[]).forEach(i=>{n(i)?c(i)?this.storeSupportabilityMetrics("Generic/Resources/Ajax/Internal"):this.storeSupportabilityMetrics("Generic/Resources/Non-Ajax/Internal"):c(i)?this.storeSupportabilityMetrics("Generic/Resources/Ajax/External"):this.storeSupportabilityMetrics("Generic/Resources/Non-Ajax/External")}),t.ptid&&this.storeSupportabilityMetrics("PageSession/Feature/SessionTrace/DurationMs",Math.round(performance.now())),typeof performance<"u"){const i=performance.getEntriesByType("mark"),u=performance.getEntriesByType("measure");this.storeSupportabilityMetrics("Generic/Performance/Mark/Seen",i.length),this.storeSupportabilityMetrics("Generic/Performance/Measure/Seen",u.length)}}catch{}}}h(V,"featureName",d);export{V as Aggregate};
