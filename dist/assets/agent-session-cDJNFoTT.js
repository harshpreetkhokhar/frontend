import{g,a as h,b as l,c as d,d as m,e as p}from"./index-iGRhHhaY.js";import{S as y}from"./session-entity-L9wlHB7X.js";import"./invoke-yZTpZaXg.js";class S{get(e){try{return localStorage.getItem(e)||void 0}catch{return""}}set(e,t){try{return t==null?this.remove(e):localStorage.setItem(e,t)}catch{}}remove(e){try{localStorage.removeItem(e)}catch{}}}class f{constructor(e){this.domain=e}get(e){try{var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));if(t)return t[2]}catch{return""}}set(e,t){try{const o="".concat(e,"=").concat(t,"; Domain=").concat(this.domain,"; Path=/");document.cookie=o}catch{}}remove(e){try{document.cookie="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; Domain=").concat(this.domain,"; Path=/")}catch{}}}let b=0;function v(s){const e=g(s);if(b++)return e.session;const t=h(s).session,o=t!=null&&t.domain?new f(t.domain):new S;e.session=new y({agentIdentifier:s,key:"SESSION",storage:o,expiresMs:t==null?void 0:t.expiresMs,inactiveMs:t==null?void 0:t.inactiveMs});const c=e.session.state.custom,a=l(s);c&&(a.jsAttributes={...a.jsAttributes,...c});const i=d.get(s);return m("api-setCustomAttribute",(u,r,n)=>{e.session.syncCustomAttribute(r,n)},"session",i),m("api-setUserId",(u,r,n)=>{e.session.syncCustomAttribute(r,n)},"session",i),p(s,"session"),e.session}export{v as setupAgentSession};
